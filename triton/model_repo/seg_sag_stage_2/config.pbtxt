name: "seg_sag_stage_2"
platform: "onnxruntime_onnx"
max_batch_size: 1  # Only single batch to prevent memory issues

input [
  {
    name: "input"
    data_type: TYPE_FP32
    dims: [2, 128, 96, 96]
  }
]

output [
  {
    name: "output"
    data_type: TYPE_FP32
    dims: [11, 128, 96, 96]
  }
]

instance_group [
  { kind: KIND_CPU, count: 1 }
]

# Disable dynamic batching for stage 2 to minimize memory usage
# dynamic_batching {
#   preferred_batch_size: [1]
#   max_queue_delay_microseconds: 10000
# }

parameters {
  key: "enable_memory_growth"
  value: { string_value: "true" }
}

parameters {
  key: "intra_op_num_threads"
  value: { string_value: "4" }
}

parameters {
  key: "inter_op_num_threads"
  value: { string_value: "2" }
}

parameters {
  key: "execution_mode"
  value: { string_value: "0" }
}
